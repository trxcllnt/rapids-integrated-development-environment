#! /usr/bin/env bash

set -Eeo pipefail

export DEBIAN_FRONTEND=noninteractive

# https://github.com/moby/buildkit/blob/b8462c3b7c15b14a8c30a79fad298a1de4ca9f74/frontend/dockerfile/docs/syntax.md#example-cache-apt-packages
rm -f /etc/apt/apt.conf.d/docker-clean;
echo 'Binary::apt::APT::Keep-Downloaded-Packages "true";' > /etc/apt/apt.conf.d/keep-cache

#######################################################
# Update SSL certs
#######################################################
apt update;
apt install -y --no-install-recommends \
    gpg libssl-dev ca-certificates \
 && update-ca-certificates;

#######################################################
# Install dependencies
#######################################################
apt install -y --no-install-recommends \
    software-properties-common \
    apt-utils apt-transport-https \
    wget curl libcurl4-openssl-dev \
    sudo locales;

# https://wiki.debian.org/Locale#Manually
sed -i "s/# en_US.UTF-8/en_US.UTF-8/" /etc/locale.gen \
 && locale-gen;
